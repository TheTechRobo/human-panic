# human-panic
[![crates.io version][1]][2] [![build status][3]][4]
[![downloads][5]][6] [![docs.rs docs][7]][8]

Panic messages for humans. Handles panics by calling
[`std::panic::set_hook`](https://doc.rust-lang.org/std/panic/fn.set_hook.html)
to make errors nice for humans.

- [Documentation][8]
- [Crates.io][2]

## Why?
When you're building a CLI, polish is super important. Even though Rust is
pretty great at safety, it's not unheard of to access the wrong index in a
vector or have an assert fail somewhere.

When an error eventually occurs, you probably will want to know about it. So
instead of just providing an error message on the command line, we can create a
call to action for people to submit a report.

This should empower people to engage in communication, lowering the chances
people might get frustrated. And making it easier to figure out what might be
causing bugs.

### Default Output

```txt
thread 'main' panicked at 'oops', examples/main.rs:2:3
note: Run with `RUST_BACKTRACE=1` for a backtrace.
```

### Human-Panic Output

```txt
Well, this is embarrassing.

human-panic had a problem and crashed. To help us diagnose the problem you can send us a crash report.

We have generated a report file at "/var/folders/zw/bpfvmq390lv2c6gn_6byyv0w0000gn/T/report-8351cad6-d2b5-4fe8-accd-1fcbf4538792.toml". Submit an issue or email with the subject of "human-panic Crash Report" and include the report as an attachment.

- Homepage: https://github.com/yoshuawuyts/human-panic
- Authors: Yoshua Wuyts <yoshuawuyts@gmail.com>

We take privacy seriously, and do not perform any automated error collection. In order to improve the software, we rely on people to submit reports.

Thank you kindly!
```

The error dump file generated by `human-panic` contains the following fields.

```toml
name = 'single-panic-test'
operating_system = 'Debian (11) (64-bit)'
crate_version = '0.1.0'
explanation = '''
Panic occurred in file 'src/main.rs' at line 7
'''
cause = 'OMG EVERYTHING IS ON FIRE!!!'
method = 'Panic'
backtrace = '''

   0: 0x5653024632af - single_panic_test::main::he5bb913b8d0d66af
   1: 0x565302462623 - std::sys_common::backtrace::__rust_begin_short_backtrace::hd30268eb783a3896
   2: 0x5653024625f9 - std::rt::lang_start::{{closure}}::h13e747e3f66b7484
   3: 0x5653024ab7da - core::ops::function::impls::<impl core::ops::function::FnOnce<A> for &F>::call_once::h02e5de65baee3e0a
                at /rustc/d394408fb38c4de61f765a3ed5189d2731a1da91/library/core/src/ops/function.rs:280
                 - std::panicking::try::do_call::h928f62916d7b4bf7
                at /rustc/d394408fb38c4de61f765a3ed5189d2731a1da91/library/std/src/panicking.rs:492
                 - std::panicking::try::he5e8d9bda1fee0d9
                at /rustc/d394408fb38c4de61f765a3ed5189d2731a1da91/library/std/src/panicking.rs:456
                 - std::panic::catch_unwind::hbdacb0480f3c3a44
                at /rustc/d394408fb38c4de61f765a3ed5189d2731a1da91/library/std/src/panic.rs:137
                 - std::rt::lang_start_internal::{{closure}}::h9307a76627b54f4f
                at /rustc/d394408fb38c4de61f765a3ed5189d2731a1da91/library/std/src/rt.rs:128
                 - std::panicking::try::do_call::h0baecbe86a821dd2
                at /rustc/d394408fb38c4de61f765a3ed5189d2731a1da91/library/std/src/panicking.rs:492
                 - std::panicking::try::h6c0869befc863f62
                at /rustc/d394408fb38c4de61f765a3ed5189d2731a1da91/library/std/src/panicking.rs:456
                 - std::panic::catch_unwind::h135074234245f66c
                at /rustc/d394408fb38c4de61f765a3ed5189d2731a1da91/library/std/src/panic.rs:137
                 - std::rt::lang_start_internal::h498f9556b87c8e5f
                at /rustc/d394408fb38c4de61f765a3ed5189d2731a1da91/library/std/src/rt.rs:128
   4: 0x565302463ed2 - main
   5: 0x7f0d6200cd0a - __libc_start_main
                at ./csu/../csu/libc-start.c:308
   6: 0x565302460b3a - _start
   7:        0x0 - <unresolved>'''
cargo_version = 'cargo 1.65.0-nightly (4fd148c47 2022-08-03)'
```

## Usage

```rust no_run
use human_panic::setup_panic;

fn main() {
   setup_panic!();

   println!("A normal log message");
   panic!("OMG EVERYTHING IS ON FIRE!!!")
}
```

It only displays a human-friendly panic message in release mode:

```sh
$ cargo run --release
```

## Installation

```sh
$ cargo add human-panic
```

## License
[MIT](./LICENSE-MIT) OR [Apache-2.0](./LICENSE-APACHE)

[1]: https://img.shields.io/crates/v/human-panic.svg?style=flat-square
[2]: https://crates.io/crates/human-panic
[3]: https://img.shields.io/travis/rust-cli/human-panic.svg?style=flat-square
[4]: https://travis-ci.org/rust-cli/human-panic
[5]: https://img.shields.io/crates/d/human-panic.svg?style=flat-square
[6]: https://crates.io/crates/human-panic
[7]: https://docs.rs/human-panic/badge.svg
[8]: https://docs.rs/human-panic
